# Video Streaming Setup

This project uses **HLS (HTTP Live Streaming)** to deliver videos dynamically in the frontend. The backend serves `.m3u8` and `.ts` segment files generated by **FFmpeg**, and the frontend consumes them using **Hls.js** in React.

---

## How Video Streaming Works (Theory)

1. **Input Video**: You start with a local video file (`sample.mp4`) or a live camera stream.
2. **FFmpeg Conversion**:

   * FFmpeg splits the video into small `.ts` chunks (segments).
   * A playlist file (`index.m3u8`) is created, listing the segments in order.
   * This is the HLS format that browsers can stream progressively.
3. **Backend (Flask)**:

   * Flask serves `.m3u8` and `.ts` files from the `mystream/` directory.
   * Example:

     ```
     http://localhost:5000/hls/index.m3u8
     ```
4. **Frontend (React)**:

   * The React app uses `Hls.js` to load the `.m3u8` playlist.
   * The video player continuously requests small `.ts` files and plays them in sequence.
5. **Overlay Rendering**:

   * While the video plays, overlay data from MongoDB is drawn on top of the video (text or image).

---

## Installation Requirements

* **FFmpeg**: Must be installed on your system.
* **Python (Flask)**: Backend server.
* **Node.js**: Frontend build and development server.

---

## FFmpeg Installation

### Linux (Ubuntu/Debian)

```bash
sudo apt update
sudo apt install ffmpeg
ffmpeg -version
```

### macOS (Homebrew)

```bash
brew install ffmpeg
ffmpeg -version
```

### Windows

1. Download FFmpeg from: [https://ffmpeg.org/download.html](https://ffmpeg.org/download.html)
2. Extract it and add the `bin/` folder path to your **System Environment Variables → PATH**.
3. Verify:

   ```powershell
   ffmpeg -version
   ```

---

## Converting Video to HLS

Run this command inside the **project root** where your `sample.mp4` exists:

```bash
ffmpeg -i sample.mp4 \
   -profile:v baseline -level 3.0 -s 640x360 -start_number 0 \
   -hls_time 10 -hls_list_size 0 -f hls mystream/index.m3u8
```

### Explanation:

* `-i sample.mp4`: Input video file.
* `-profile:v baseline -level 3.0`: Ensures compatibility with most players.
* `-s 640x360`: Resize to 360p (change resolution if needed).
* `-start_number 0`: Segments start at 0.
* `-hls_time 10`: Each segment is 10 seconds.
* `-hls_list_size 0`: Include all segments in the playlist.
* `-f hls mystream/index.m3u8`: Output folder/playlist file.

This generates:

```
mystream/
 ├── index.m3u8
 ├── 0.ts
 ├── 1.ts
 ├── 2.ts
 └── ...
```

---

## Running the Flow

1. **Convert Video**
   Run the FFmpeg command above (or automate in a script).
2. **Start Backend**

   ```bash
   python app.py
   ```
3. **Start Frontend**

   ```bash
   npm start
   ```
4. **Play Video**
   Open frontend in browser, video loads automatically from:

   ```
   http://localhost:5000/hls/index.m3u8
   ```

---

## Live Streaming Option (Optional)

If you want **live camera feed** instead of pre-recorded video:

```bash
ffmpeg -f v4l2 -i /dev/video0 \
   -c:v libx264 -crf 23 -preset veryfast \
   -f hls -hls_time 2 -hls_list_size 5 \
   mystream/index.m3u8
```

* Linux: `/dev/video0` = webcam device.
* Windows: use `dshow` input, e.g.:

  ```bash
  ffmpeg -f dshow -i video="Integrated Webcam" mystream/index.m3u8
  ```

---

## Development vs Production

* **Development**: Run FFmpeg manually whenever you change the input video.
* **Production**: Automate with a script (e.g. `start_stream.sh`) so FFmpeg runs and updates `mystream/` continuously.

---

⚡ With this setup:

* You can put **any video file or webcam input**,
* FFmpeg converts it to HLS (`index.m3u8`),
* Flask serves it,
* React plays it with overlays from MongoDB.
